Firebase示例数据导入实现日志
===========================================
创建日期: 2025-01-04
项目: GoGoFood - 餐厅订餐系统

OVERVIEW
--------
本文档记录了为GoGoFood项目创建Firebase示例数据和导入功能的实现过程。
根据 "information should save in firebase.txt" 中的规范，创建了完整的示例数据
和导入工具。

文件结构
--------
1. information/firebase_sample_data.json - 示例数据JSON文件
2. app/src/main/java/com/group14/foodordering/util/FirebaseDataImporter.java - 数据导入工具类
3. app/src/main/java/com/group14/foodordering/model/ - 新增模型类
   - Branch.java - 分店模型
   - Table.java - 桌台模型
   - MenuCategory.java - 菜单分类模型
   - AppConfig.java - 应用配置模型

Firebase集合结构
----------------

1. users Collection (用户集合)
   - 用途: 存储所有注册用户（客户和员工）
   - 文档字段:
     * userId: 用户唯一ID
     * email: 邮箱地址
     * name: 用户名称
     * phone: 电话号码
     * role: 角色（customer, server, kitchen, manager）
     * createdAt: 创建时间戳
     * updatedAt: 更新时间戳
   - 示例数据: 5个用户（2个客户，1个服务员，1个厨房，1个经理）

2. admins Collection (管理员集合)
   - 用途: 存储管理员信息和权限
   - 文档字段:
     * adminId: 管理员ID（员工ID）
     * userId: 关联的用户ID
     * email: 邮箱
     * name: 姓名
     * phone: 电话
     * permissions: 权限数组（如 ["menu_edit", "report_view"]）
     * isActive: 是否激活
     * createdAt/updatedAt: 时间戳
   - 示例数据: 3个管理员（经理、服务员、厨房）

3. branches Collection (分店集合)
   - 用途: 存储餐厅分店信息
   - 文档字段:
     * branchId: 分店ID
     * branchName: 分店名称
     * address: 地址
     * phoneNumber: 电话号码
     * geolocation: 地理位置 {latitude, longitude}
     * openingHours: 营业时间 {monday: "09:00-22:00", ...}
     * isActive: 是否激活
     * createdAt/updatedAt: 时间戳
   - 示例数据: 2个分店（West Street Branch, East Avenue Branch）

4. tables Collection (桌台集合)
   - 用途: 管理餐厅桌台状态
   - 文档字段:
     * tableId: 桌台ID
     * tableNumber: 桌号（如 "A1"）
     * branchId: 所属分店ID
     * status: 状态（available, occupied, needs_cleaning）
     * capacity: 容量
     * currentOrderId: 当前订单ID
     * createdAt/updatedAt: 时间戳
   - 示例数据: 5个桌台（A1-A3, B1-B2）

5. menuCategories Collection (菜单分类集合)
   - 用途: 存储菜单分类
   - 文档字段:
     * categoryId: 分类ID
     * categoryName: 分类名称（内部）
     * displayName: 显示名称
     * displayOrder: 显示顺序
     * isActive: 是否激活
     * createdAt/updatedAt: 时间戳
   - 示例数据: 4个分类（Appetizer, Main Course, Dessert, Beverage）

6. menuItems Collection (菜单项集合)
   - 用途: 存储所有菜品
   - 文档字段:
     * itemId: 菜品ID
     * name: 菜品名称
     * description: 描述
     * price: 价格
     * category: 分类（旧字段，兼容）
     * categoryId: 分类ID（新字段）
     * imageUrl: 图片URL
     * isAvailable: 是否可用
     * stock: 库存（-1表示无限制）
     * createdAt/updatedAt: 时间戳
   - 示例数据: 5个菜品（Peking Duck, Claypot Rice, Spring Rolls, Mango Pudding, Green Tea）

7. itemModifiers Collection (菜品修饰符集合) - 可选
   - 用途: 管理菜品自定义选项
   - 文档字段:
     * modifierId: 修饰符ID
     * modifierGroup: 组名（如 "Size", "Add-ons"）
     * menuItemIds: 关联的菜品ID数组
     * options: 选项数组 [{optionName, additionalPrice}]
     * isRequired: 是否必需
     * createdAt/updatedAt: 时间戳
   - 示例数据: 2个修饰符组（Size, Add-ons）

8. ingredients Collection (食材集合) - 可选
   - 用途: 实时库存跟踪
   - 文档字段:
     * ingredientId: 食材ID
     * ingredientName: 食材名称
     * unit: 单位
     * currentStockLevel: 当前库存
     * lowStockThreshold: 低库存阈值
     * isActive: 是否激活
     * createdAt/updatedAt: 时间戳
   - 示例数据: 4种食材（Chicken Breast, Onion, Rice, Duck）

9. orders Collection (订单集合)
   - 用途: 存储所有订单
   - 文档字段:
     * orderId: 订单ID
     * orderNumber: 订单号（如 "1234"）
     * userId: 用户ID（在线订单）
     * branchId: 分店ID
     * tableNumber: 桌号（桌台订单）
     * orderType: 订单类型（online, table）
     * items: 订单项数组
     * status: 状态（pending, preparing, ready, completed, cancelled）
     * subtotal: 小计
     * tax: 税费
     * serviceCharge: 服务费
     * discount: 折扣
     * total: 总价
     * paymentMethod: 支付方式
     * paymentStatus: 支付状态（pending, paid, refunded）
     * deliveryTime: 配送时间
     * createdAt/updatedAt: 时间戳
   - 示例数据: 1个示例订单

10. transactions Collection (交易集合)
    - 用途: 存储支付记录
    - 文档字段:
      * transactionId: 交易ID
      * orderId: 订单ID
      * paymentMethod: 支付方式
      * amount: 金额
      * transactionIdExternal: 外部交易ID
      * status: 状态（pending, success, failed）
      * createdAt/updatedAt: 时间戳
    - 示例数据: 1个示例交易

11. appConfig Collection (应用配置集合)
    - 用途: 全局应用设置
    - 文档字段:
      * configId: 配置ID（固定为 "settings"）
      * taxRate: 税率
      * serviceChargeRate: 服务费费率
      * supportedPaymentMethods: 支持的支付方式数组
      * currency: 货币代码
      * currencySymbol: 货币符号
      * promotionBanner: 促销横幅
      * deliveryTimeOptions: 配送时间选项数组
      * createdAt/updatedAt: 时间戳
    - 示例数据: 1个配置文档

12. dailySalesReports Collection (日销售报告集合) - 可选
    - 用途: 每日销售报告
    - 文档字段:
      * reportId: 报告ID（如 "report-2025-01-04"）
      * date: 日期
      * branchId: 分店ID
      * totalSales: 总销售额
      * totalOrders: 总订单数
      * topSellingItem: 最热销商品
      * paymentMethodBreakdown: 支付方式明细
      * createdAt/updatedAt: 时间戳
    - 示例数据: 1个示例报告

实现详情
--------

1. FirebaseDataImporter类
   - 位置: app/src/main/java/com/group14/foodordering/util/FirebaseDataImporter.java
   - 功能:
     * 从JSON文件读取数据
     * 解析JSON并转换为模型对象
     * 批量导入到Firebase Firestore
     * 提供进度回调和错误处理
   - 方法:
     * importFromFile(String, ImportCallback) - 从文件导入
     * importFromJson(JSONObject) - 从JSON对象导入
     * importUsers(JSONArray) - 导入用户
     * importAdmins(JSONArray) - 导入管理员
     * importBranches(JSONArray) - 导入分店
     * importTables(JSONArray) - 导入桌台
     * importMenuCategories(JSONArray) - 导入菜单分类
     * importMenuItems(JSONArray) - 导入菜单项
     * importAppConfig(JSONObject) - 导入应用配置

2. 新增模型类
   - Branch.java: 分店数据模型
   - Table.java: 桌台数据模型
   - MenuCategory.java: 菜单分类数据模型
   - AppConfig.java: 应用配置数据模型
   - 所有模型类都实现了toMap()方法用于Firestore存储

3. TestDataActivity扩展
   - 添加了"导入完整示例数据"按钮
   - 实现了importSampleData()方法
   - 从information/firebase_sample_data.json读取数据
   - 显示导入进度和结果

使用方法
--------

步骤1: 准备数据文件
- 确保 information/firebase_sample_data.json 文件存在
- 文件应包含所有集合的示例数据

步骤2: 访问测试数据页面
- 在MainActivity中登录为管理员
- 点击"Test Data"按钮

步骤3: 导入数据
- 点击"导入完整示例数据"按钮
- 等待导入完成
- 查看导入结果和统计信息

步骤4: 验证数据
- 在Firebase控制台检查各集合
- 验证数据是否正确导入
- 检查文档数量和字段完整性

注意事项
--------

1. 数据覆盖
   - 导入会覆盖具有相同ID的现有文档
   - 建议在测试环境或空数据库中导入

2. 网络连接
   - 需要稳定的网络连接到Firebase
   - 导入大量数据可能需要一些时间

3. 权限要求
   - 确保Firebase安全规则允许写入操作
   - 建议在开发阶段使用开放的读写规则

4. 数据完整性
   - 某些集合之间有依赖关系
   - 例如：tables需要branches，menuItems可以使用menuCategories
   - 导入顺序已考虑依赖关系

5. 错误处理
   - 导入工具会记录每个集合的成功/失败数量
   - 检查日志以了解具体错误信息
   - 部分失败不影响其他集合的导入

技术细节
--------

1. JSON解析
   - 使用org.json库解析JSON
   - 支持嵌套对象和数组
   - 处理缺失字段（使用optString, optInt等）

2. Firestore操作
   - 使用set()方法进行创建/更新
   - 每个文档使用唯一ID
   - 批量操作使用异步回调

3. 线程安全
   - 所有UI更新都在主线程执行
   - 使用runOnUiThread()确保线程安全

4. 错误处理
   - 捕获JSONException和IOException
   - 记录详细错误日志
   - 通过回调通知调用者

未来扩展
--------

1. 支持更多集合
   - itemModifiers（菜品修饰符）
   - ingredients（食材库存）
   - transactions（交易记录）
   - dailySalesReports（销售报告）

2. 功能增强
   - 支持增量导入（只导入新数据）
   - 支持数据验证
   - 支持导入前备份
   - 支持导入进度条显示

3. 性能优化
   - 使用批量写入（WriteBatch）
   - 并行导入多个集合
   - 添加重试机制

4. 数据管理
   - 添加数据导出功能
   - 支持数据迁移
   - 支持数据清理工具

总结
----

本实现提供了完整的Firebase示例数据导入功能，包括：
- 完整的示例数据JSON文件
- 数据导入工具类
- 必要的模型类
- 用户界面集成

所有代码都遵循Android开发最佳实践，包括：
- 适当的错误处理
- 线程安全
- 代码注释和文档
- 可扩展的架构

最后更新: 2025-01-04

